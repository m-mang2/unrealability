# 게임 플레이 어빌리티 시스템의 기본 흐름
![image](https://github.com/m-mang2/unrealability/assets/135841268/eefdd510-6913-4098-8926-d75649c5c28f)

# 플레이어 캐릭터의 ASC 설정
![image](https://github.com/m-mang2/unrealability/assets/135841268/8351c4db-020a-497c-be61-415a6973f625)
멀티플레이에 적용할 것이라면 고민해야하는 사항
* 서버데이터와 클라이언트 데이터를 구분해야함
* **가스시스템도 결국 데이터이기 때문에 데이터는 PlayerState에서 담당**
* 실제 게임에서 물체와 상호작용은 AvataActor에서 사용

# GameAbilitySpec
게임 어빌리티에 대한 정보를 담고있는 구조체
ASC는 직접 데이터를 관리하지 않고 GameAbilitySpec를 통하여 데이터를 관리
ASC에서 어빌리티를 관리하기 위해서는 Handle을 이용해야함
#### 입력처리
Spec에는 입력값을 설정하는 InputID라는 필드가 제공 되는데 FindAbilitySpecFromInputID를 통해서 GA검색
GA를 발견 하였을 때 발동중이라면 AbilitySpecInputPressed, 발동중이 아니라서 새롭게 발동하려면 TryActivateAbility를 사용, 입력이 끝이라면 AbilitySpecInputRealeased

# 어빌리티의 인스턴싱 옵션
* Noninstanced : 인스턴싱 없이 CDO에서 일괄 처리, 기본적인 기능, 가볍지만 상태가 부여되는 게임 어빌리티를 만들때는 적합하지 않음
* **InstancedPerActor** : 액터마다 하나의 어빌리티 인스턴스를 만들어처리 대부분의 경우에 적합, 캐릭터 액션이 여러게 동시에 재생하지 않으니..
* InstancedPerExecution : 발동시 인스턴스 생성, 다수가 생김

# Ability Task(AT)
게임플레이 어빌리티(GA) 의 실행은 EndAbility함수가 호출될 때 까지 멈추지 않음
애니메이션 같이 일정 시간이 후에 끝나야하는 작업은 결과를 통보 받아야하는데 이때 사용되는게 AT

### 활용 패턴
1. 어빌리티 태스크에 작업이 끝나면 브로드캐스팅 되는 종료 델리게이트 선언
2. GA에서 AT를 생성후 바로 종료 델리게이트 구독
3. GA구독이 완료되면 AT구동 (ReadyForActivation 호출)
4. AT작업이 끝나면 델리게이트에서 콜백함수 호출
5. 콜백함수 내에서 EndAbility함수 호출
```
// 작업 시작
/*
 .. 작업 ..
*/
UAbilityTask_PlayMontageAndWait* PlayAttackTask = UAbilityTask_PlayMontageAndWait::CreatePlayMontageAndWaitProxy(this, TEXT("PlayAttack"), ABCharacter->GetComboActionMontage());

// 종료 콜백을 구독해야함
PlayAttackTask->OnCompleted.AddDynamic(this, &UABGA_Attack::OnCompleteCallback); // DECLARE_DYNAMIC_MULTICAST_DELEGATE(FMontageWaitSimpleDelegate); 매개변수 없는 콜백
PlayAttackTask->OnInterrupted.AddDynamic(this, &UABGA_Attack::OnInterruptedCallback); // 중단

PlayAttackTask->ReadyForActivation(); // 이걸 호출해야 실행이됨

void UABGA_Attack::OnCompleteCallback()
{
EndAbility(CurrentSpecHandle, CurrentActorInfo, CurrentActivationInfo, true, false); // 4번째 인자가 중단여부라서 OnInterruptedCallback에서는 이 인자가 true
}
```


# GA의 블루 프린트 상속 및 게임 플레이 태그 설정
GA, AT는 가급적 자기 역할에만 충실
C++로 태그를 설정 할 경우 변경 때 마다 계속 컴파일 해야함
게임 플레이 태그를 블루 프린트로 설정 하는것이 의존성분리에 도움이됨

블루프린트에 설정방법
GA를 블루 프린트로 설정하면 Tags가 보이고 원하는 위치에 태그를 잘 넣음..
![image](https://github.com/m-mang2/unrealability/assets/135841268/3aa7beb1-6b4a-4776-9385-ae15b544af87)



어빌리티 시스템 확인방법
`키를 누르고 showdebug abilitysystem을 치면 화면에 디버깅 창이 나옴
![image](https://github.com/m-mang2/unrealability/assets/135841268/3d7d3ae6-e6c2-40fd-ab66-1f3ae4906520)

추가 사항
캐릭터 멈추는 방법으로 MovementMode를 none으로 설정하면 멈춤 걷고싶으면 Walking로 변경하면됨
```
AABCharacterBase* ABCharacter = Cast<AABCharacterBase>(ActorInfo->AvatarActor.Get());
if (ABCharacter)
{
	ABCharacter->GetCharacterMovement()->SetMovementMode(EMovementMode::MOVE_None);
}
```
